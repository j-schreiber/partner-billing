/**
*   Use this code to reset all time entries in database (that are not yet invoiced, because invoiced timeentries are
*   blocked from any edit / delete). Insert a configurable number of time entries per every account.
*   Time Entries generated by this code will be used on process stage 1 (Select Time Entries) of a billing run,
*
*   Adjust BULK_NUMBER (and probably also create new accounts) for load testing.
*/

/**     Configure number of approved time entries per account */
Integer BULK_NUMBER = 7;

/**     Change here to add new products or remove products */
List<Product2> products = [SELECT Id FROM Product2 WHERE IsActive = true];

delete [SELECT Id FROM TimeEntry__c WHERE IsInvoiced__c = false];

List<TimeEntry__c> tes = new List<TimeEntry__c>();
for (Account a : [SELECT Id FROM Account]) {
    for (Integer i = 0; i < BULK_NUMBER; i++) {
        tes.add(TestDataFactory.CreateTimeEntry(
            new TimeEntry__c(Account__c=a.Id,Status__c='Approved',DailyRate__c=1250,StartTime__c=getStartTime(),EndTime__c=getEndTime(),Date__c=getDate(),Product__c=getRandomProduct().Id)
        ));
        tes.add(TestDataFactory.CreateTimeEntry(
            new TimeEntry__c(Account__c=a.Id,Status__c='Approved',DailyRate__c=650,StartTime__c=getStartTime(),EndTime__c=getEndTime(),Date__c=getDate(),Product__c=getRandomProduct().Id)
        ));
        tes.add(TestDataFactory.CreateTimeEntry(
            new TimeEntry__c(Account__c=a.Id,Status__c='Approved',DailyRate__c=555,StartTime__c=getStartTime(),EndTime__c=getEndTime(),Date__c=getDate(),Description__c='Custom stuff done')
        ));
    }
}

insert tes;

public Product2 getRandomProduct() {
    return products[Integer.valueOf(Math.random() * (products.size() - 1))];
}

public Time getStartTime() {
    return Time.newInstance(6, 0, 0, 0).addMinutes(Integer.valueOf(Math.random() * 120));
}

public Time getEndTime() {
    return Time.newInstance(15, 0, 0, 0).addMinutes(Integer.valueOf(Math.random() * 240));
}

public Date getDate() {
    return Date.newInstance(2019, System.today().month() - 1, 1).addDays(Integer.valueOf(Math.random() * 30));
}